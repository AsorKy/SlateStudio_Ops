<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeTracker — SlateStudio</title>

  <!-- Playfair Display: heritage serif for headers -->
  <!-- Inter: geometric sans-serif for all functional UI -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ═══════════════════════════════════════════════
       COLOUR SYSTEM
       Deep Slate  #3b494d  — page canvas
       Dark Gray   #565b5e  — structural containers
       Muted Olive #8e8e74  — secondary text, borders
       Terracotta  #c27a61  — interaction pulse
    ═══════════════════════════════════════════════ */
    :root {
      --slate:   #3b494d;
      --gray:    #565b5e;
      --olive:   #8e8e74;
      --terra:   #c27a61;
      --terra-d: #ae6b53;  /* hover / pressed terracotta */

      /* Surfaces */
      --bg:      #3b494d;  /* page canvas */
      --card:    #565b5e;  /* form card */
      --well:    #2e3b3f;  /* input fields — sunken / tactile */

      /* Text */
      --t-head:  #eae3d5;  /* headings — warm off-white */
      --t-body:  #cbc4b4;  /* body copy */
      --t-label: #aaaa8e;  /* field labels */
      --t-ph:    rgba(142, 136, 100, 0.48); /* placeholders */

      /* Borders */
      --bdr:     rgba(142, 142, 116, 0.22);
      --bdr-h:   rgba(142, 142, 116, 0.40);
      --bdr-f:   #c27a61;  /* focus ring — terracotta */

      /* Feedback */
      --ok-bg:   rgba(100, 120, 80, 0.22);
      --ok-bdr:  rgba(110, 135, 85, 0.50);
      --ok-t:    #a0c080;
      --er-bg:   rgba(160, 72, 60, 0.20);
      --er-bdr:  rgba(170, 78, 65, 0.45);
      --er-t:    #d08878;

      --r: 3px;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg);
      color: var(--t-body);
      min-height: 100vh;
      padding: 56px 20px 80px;
    }

    .shell {
      max-width: 640px;
      margin: 0 auto;
    }

    /* ─── Page header ─────────────────────────────── */
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .wordmark {
      display: inline-block;
      font-family: 'Inter', sans-serif;
      font-size: 9.5px;
      font-weight: 600;
      letter-spacing: .26em;
      text-transform: uppercase;
      color: var(--olive);
      margin-bottom: 20px;
    }

    .page-header h1 {
      font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
      font-size: 40px;
      font-weight: 400;
      font-style: normal;
      line-height: 1.1;
      letter-spacing: -.5px;
      color: var(--t-head);
      margin-bottom: 11px;
    }

    .page-header h1 em {
      font-style: italic;
      color: var(--terra);
    }

    .page-header .sub {
      font-size: 13px;
      font-weight: 300;
      letter-spacing: .03em;
      color: var(--olive);
    }

    /* ─── Form card ───────────────────────────────── */
    .card {
      background: var(--card);
      border: 1px solid var(--bdr);
      border-radius: 4px;
      padding: 42px 48px 48px;
    }

    /* ─── Loading banner ──────────────────────────── */
    .banner {
      display: flex;
      align-items: center;
      gap: 11px;
      border-radius: var(--r);
      padding: 11px 16px;
      font-size: 12.5px;
      font-weight: 400;
      letter-spacing: .02em;
      margin-bottom: 32px;
      background: rgba(194, 122, 97, 0.10);
      border: 1px solid rgba(194, 122, 97, 0.30);
      color: var(--terra);
    }

    .banner.err {
      background: var(--er-bg);
      border-color: var(--er-bdr);
      color: var(--er-t);
    }

    .banner.hidden { display: none; }

    .banner .spin {
      width: 13px; height: 13px; flex-shrink: 0;
      border: 1.5px solid rgba(194, 122, 97, 0.28);
      border-top-color: var(--terra);
      border-radius: 50%;
      animation: rotate .85s linear infinite;
    }

    @keyframes rotate { to { transform: rotate(360deg); } }

    /* ─── Section dividers ────────────────────────── */
    .section-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 34px 0 18px;
    }

    .section-row:first-of-type { margin-top: 0; }

    .section-tag {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: var(--olive);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .section-rule {
      flex: 1;
      height: 1px;
      background: var(--bdr);
    }

    /* ─── Grid layout ─────────────────────────────── */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px 22px;
    }

    .col-2 { grid-column: 1 / -1; }

    /* ─── Field wrapper ───────────────────────────── */
    .field { display: flex; flex-direction: column; gap: 8px; }

    label {
      font-size: 10.5px;
      font-weight: 600;
      letter-spacing: .09em;
      text-transform: uppercase;
      color: var(--t-label);
      user-select: none;
    }

    label .req { color: var(--terra); margin-left: 2px; font-weight: 400; }

    /* ─── Inputs, selects, textareas ──────────────── */
    input,
    select,
    textarea {
      width: 100%;
      background: var(--well);
      border: 1px solid var(--bdr);
      border-radius: var(--r);
      padding: 13px 16px;
      font-family: 'Inter', sans-serif;
      font-size: 13.5px;
      font-weight: 400;
      color: var(--t-head);
      transition: border-color .18s, background .18s;
      appearance: none;
      -webkit-appearance: none;
    }

    input::placeholder,
    textarea::placeholder { color: var(--t-ph); }

    input:hover, select:hover, textarea:hover { border-color: var(--bdr-h); }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--bdr-f);
      background: #2a3840;  /* slightly warmer, terracotta-tinted well */
    }

    /* Select — olive chevron, terracotta on focus */
    select {
      cursor: pointer;
      padding-right: 36px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%238e8e74' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
    }

    select:focus {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23c27a61' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
    }

    select:disabled { opacity: .38; cursor: not-allowed; }

    /* Option list colours (Chromium/Windows) */
    select option { background: #2e3b3f; color: var(--t-head); }

    textarea { resize: vertical; min-height: 98px; line-height: 1.65; }

    /* Date picker icon — subtle */
    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
      opacity: .28;
      cursor: pointer;
    }

    input[type="date"]:focus::-webkit-calendar-picker-indicator { opacity: .55; }

    /* Remove number spinners */
    input[type="number"] { -moz-appearance: textfield; }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

    /* ─── Actions row ─────────────────────────────── */
    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 36px;
      padding-top: 24px;
      border-top: 1px solid var(--bdr);
    }

    .btn-clear {
      font-family: 'Inter', sans-serif;
      font-size: 11.5px;
      font-weight: 500;
      letter-spacing: .06em;
      color: var(--olive);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 0;
      transition: color .15s;
    }

    .btn-clear:hover { color: var(--t-label); }

    .btn-submit {
      display: inline-flex;
      align-items: center;
      gap: 9px;
      background: var(--terra);
      color: #f5ede5;
      border: none;
      border-radius: var(--r);
      padding: 13px 30px;
      font-family: 'Inter', sans-serif;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .13em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background .15s;
    }

    .btn-submit:hover:not(:disabled) { background: var(--terra-d); }
    .btn-submit:disabled { opacity: .45; cursor: not-allowed; }

    .btn-submit .s-spin {
      display: none;
      width: 13px; height: 13px;
      border: 1.5px solid rgba(245, 237, 229, 0.30);
      border-top-color: #f5ede5;
      border-radius: 50%;
      animation: rotate .85s linear infinite;
    }

    .btn-submit.loading .s-spin { display: block; }
    .btn-submit.loading .s-icon { display: none; }

    /* ─── Result toast ────────────────────────────── */
    #toast {
      margin-top: 18px;
      border-radius: var(--r);
      padding: 13px 18px;
      font-size: 13px;
      font-weight: 400;
      line-height: 1.55;
      display: none;
    }

    #toast.ok  { display: block; background: var(--ok-bg); border: 1px solid var(--ok-bdr); color: var(--ok-t); }
    #toast.err { display: block; background: var(--er-bg); border: 1px solid var(--er-bdr); color: var(--er-t); }

    /* ─── Footer ──────────────────────────────────── */
    footer {
      text-align: center;
      margin-top: 28px;
      font-size: 10.5px;
      font-weight: 400;
      letter-spacing: .06em;
      color: rgba(142, 142, 116, 0.35);
    }

    /* ─── Responsive ──────────────────────────────── */
    @media (max-width: 520px) {
      body { padding: 36px 14px 60px; }
      .card { padding: 28px 22px 34px; }
      .grid { grid-template-columns: 1fr; }
      .col-2 { grid-column: auto; }
      .page-header h1 { font-size: 30px; }
    }
  </style>
</head>
<body>
  <div class="shell">

    <!-- ── Page header ──────────────────────────────── -->
    <header class="page-header">
      <p class="wordmark">SlateStudio</p>
      <h1>Report <em>Hours</em></h1>
      <p class="sub">Log your worked hours for the selected activity date.</p>
    </header>

    <!-- ── Form card ────────────────────────────────── -->
    <div class="card">

      <!-- Loading / error banner -->
      <div class="banner" id="banner">
        <div class="spin"></div>
        <span id="banner-text">Loading team data from the database…</span>
      </div>

      <form id="hour-form" novalidate autocomplete="off">

        <!-- ─────────────── WHO & WHERE ────────────── -->
        <div class="section-row">
          <span class="section-tag">Who &amp; Where</span>
          <div class="section-rule"></div>
        </div>

        <div class="grid">
          <div class="field">
            <label for="employee_name">Your Name <span class="req">*</span></label>
            <select id="employee_name" name="employee_name" required disabled>
              <option value="">— Loading… —</option>
            </select>
          </div>

          <div class="field">
            <label for="client_name">Client <span class="req">*</span></label>
            <select id="client_name" name="client_name" required disabled>
              <option value="">— Loading… —</option>
            </select>
          </div>

          <div class="field col-2">
            <label for="project_name">Project <span class="req">*</span></label>
            <select id="project_name" name="project_name" required disabled>
              <option value="">— Loading… —</option>
            </select>
          </div>
        </div>

        <!-- ─────────────── WHEN & HOW MUCH ─────────── -->
        <div class="section-row">
          <span class="section-tag">When &amp; How Much</span>
          <div class="section-rule"></div>
        </div>

        <div class="grid">
          <div class="field">
            <label for="activity_date">Activity Date <span class="req">*</span></label>
            <input type="date" id="activity_date" name="activity_date" required />
          </div>

          <div class="field">
            <label for="hours">Hours Worked <span class="req">*</span></label>
            <input type="number" id="hours" name="hours"
                   step="0.5" min="0.5" max="24" placeholder="2.5" required />
          </div>

          <div class="field">
            <label for="time_frame">Time Frame <span class="req">*</span></label>
            <select id="time_frame" name="time_frame" required>
              <option value="">— Select —</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
        </div>

        <!-- ─────────────── WHAT WAS DONE ───────────── -->
        <div class="section-row">
          <span class="section-tag">What Was Done</span>
          <div class="section-rule"></div>
        </div>

        <div class="grid">
          <div class="field col-2">
            <label for="activity_description">Activity Description <span class="req">*</span></label>
            <textarea id="activity_description" name="activity_description"
                      placeholder="Brief description of the work completed…" required></textarea>
          </div>

          <div class="field col-2">
            <label for="activity_comments">Comments &amp; Notes</label>
            <textarea id="activity_comments" name="activity_comments"
                      placeholder="Blockers, highlights, context…"></textarea>
          </div>
        </div>

        <!-- ─────────────── ACTIONS ──────────────────── -->
        <div class="actions">
          <button type="button" class="btn-clear" id="btn-reset">Clear form</button>
          <button type="submit" class="btn-submit" id="btn-submit">
            <div class="s-spin"></div>
            <svg class="s-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
            Submit Hours
          </button>
        </div>

      </form>

      <!-- Result feedback -->
      <div id="toast"></div>

    </div><!-- /.card -->

    <footer>TimeTracker &nbsp;&middot;&nbsp; SlateStudio Internal Tool</footer>

  </div><!-- /.shell -->

  <script>
    /* ═══════════════════════════════════════════════════
       Configuration — update these if N8N URLs change
    ═══════════════════════════════════════════════════ */
    const OPTIONS_URL = 'https://slatestudio.app.n8n.cloud/webhook/custom-form-options';
    const SUBMIT_URL  = 'https://slatestudio.app.n8n.cloud/webhook/custom-form';

    /* ═══════════════════════════════════════════════════
       DOM refs
    ═══════════════════════════════════════════════════ */
    const form      = document.getElementById('hour-form');
    const banner    = document.getElementById('banner');
    const bannerTxt = document.getElementById('banner-text');
    const btnSubmit = document.getElementById('btn-submit');
    const btnReset  = document.getElementById('btn-reset');
    const toast     = document.getElementById('toast');

    /* ═══════════════════════════════════════════════════
       Helpers
    ═══════════════════════════════════════════════════ */
    function todayISO() {
      return new Date().toISOString().slice(0, 10);
    }

    function fillSelect(id, items) {
      const sel = document.getElementById(id);
      sel.innerHTML = '<option value="">— Select —</option>';
      (items || []).forEach(name => {
        const opt = document.createElement('option');
        opt.value = opt.textContent = name;
        sel.appendChild(opt);
      });
      sel.disabled = false;
    }

    function setBanner(state, text) {
      banner.className = state === 'hidden' ? 'banner hidden'
                       : state === 'err'    ? 'banner err'
                       : 'banner';
      const spinEl = banner.querySelector('.spin');
      if (spinEl) spinEl.style.display = state === 'loading' ? '' : 'none';
      bannerTxt.textContent = text || '';
    }

    function showToast(type, msg) {
      toast.className = type === 'ok' ? 'ok' : 'err';
      toast.textContent = (type === 'ok' ? '✓  ' : '✗  ') + msg;
      toast.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      if (type === 'ok') setTimeout(clearToast, 9000);
    }

    function clearToast() {
      toast.className = '';
      toast.textContent = '';
    }

    function resetForm() {
      form.reset();
      form.activity_date.value = todayISO();
      clearToast();
    }

    /* ═══════════════════════════════════════════════════
       Load dynamic dropdown options on page load
    ═══════════════════════════════════════════════════ */
    async function loadOptions() {
      setBanner('loading', 'Loading team data from the database…');
      try {
        const res = await fetch(OPTIONS_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        const toArr = v =>
          Array.isArray(v) ? v :
          typeof v === 'string' ? JSON.parse(v) : [];

        fillSelect('employee_name', toArr(data.employees));
        fillSelect('client_name',   toArr(data.clients));
        fillSelect('project_name',  toArr(data.projects));

        setBanner('hidden');
      } catch (err) {
        setBanner('err', '⚠  Could not load team data. Refresh the page or contact support.');
        console.error('[TimeTracker] loadOptions error:', err);
      }
    }

    /* ═══════════════════════════════════════════════════
       Form submission
    ═══════════════════════════════════════════════════ */
    form.addEventListener('submit', async e => {
      e.preventDefault();
      clearToast();

      // Required-field validation
      for (const el of form.querySelectorAll('[required]')) {
        if (!el.value.trim()) {
          el.focus();
          const fieldName = el.labels?.[0]?.textContent?.replace('*', '').trim() || el.name;
          showToast('err', `Please fill in: ${fieldName}`);
          return;
        }
      }

      btnSubmit.disabled = true;
      btnSubmit.classList.add('loading');

      const payload = {
        employee_name:        form.employee_name.value,
        client_name:          form.client_name.value,
        project_name:         form.project_name.value,
        hours:                parseFloat(form.hours.value),
        activity_date:        form.activity_date.value,
        time_frame:           form.time_frame.value,
        activity_description: form.activity_description.value.trim(),
        activity_comments:    form.activity_comments.value.trim()
      };

      try {
        const res  = await fetch(SUBMIT_URL, {
          method:  'POST',
          headers: { 'Content-Type': 'application/json' },
          body:    JSON.stringify(payload)
        });
        const data = await res.json().catch(() => ({}));

        if (res.ok) {
          showToast('ok', data.message ||
            `${payload.hours}h submitted for ${payload.activity_date}. Thank you.`);
          resetForm();
        } else {
          showToast('err', data.message ||
            'Submission failed. Check your inputs and try again.');
        }
      } catch {
        showToast('err', 'Network error. Check your connection and try again.');
      } finally {
        btnSubmit.disabled = false;
        btnSubmit.classList.remove('loading');
      }
    });

    /* ═══════════════════════════════════════════════════
       Initialise
    ═══════════════════════════════════════════════════ */
    btnReset.addEventListener('click', resetForm);

    document.addEventListener('DOMContentLoaded', () => {
      form.activity_date.value = todayISO();
      loadOptions();
    });
  </script>
</body>
</html>
